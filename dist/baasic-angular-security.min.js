!function(e){var r=e.module("baasic.security",["baasic.api"]);r.config(["$provide",function(){}]),function(e,r){"use strict";r.directive("baasicRecaptcha",["baasicRecaptchaService",function(e){return{restrict:"A",link:function(r,n){e.create(n,{theme:"clean"}),r.$on("$destroy",function(){e&&e.destroy()})}}}])}(e,r),function(e,r,n){"use strict";var t={};r.service("baasicAuthorizationService",["$rootScope","baasicApp",function(r,s){var i=s.get(),a=i.get_apiKey();return t[a]={},{getUser:function(){var e=i.get_user();return r.user===n&&e.user!==n&&(r.user=e.user),e.user},setUser:function(e){if(e){var n=e.accessToken;delete e.accessToken,i.set_user(e,n),e.isAuthenticated=!0,r.user=e}else i.set_user(null),this.resetPermissions(),r.user={isAuthenticated:!1}},updateUser:function(r){r.accessToken||(r.accessToken=this.getAccessToken());var n=this.getUser();e.extend(n,r),this.setUser(n)},getAccessToken:function(){return i.get_accessToken()},resetPermissions:function(){t[a]={}},hasPermission:function(e){if(t[a].hasOwnProperty(e))return t[a][e];var r=this.getUser();if(r!==n){var s=!1;if(r.permissions){var i=e.split(".");if(i.length>0){var c=i[0],o=r.permissions[c];if(o)if(i.length>1){for(var u=i[1].toLowerCase(),f=0;f<o.length;f++)if(o[f].toLowerCase()==u){s=!0;break}}else s=!0}}return t[a][e]=s,s}}}}])}(e,r),function(e,r){"use strict";r.service("baasicPermissionsRouteService",["baasicUriTemplateService",function(e){return{find:function(){return e.parse("permissions/sections/{section}/{?searchQuery,sort}")},getActions:e.parse("permissions/actions/{?searchQuery,sort}"),getRoles:e.parse("roles/{?searchQuery,page,rpp,sort}"),getUsers:e.parse("users/{?searchQuery,page,rpp,sort}"),create:e.parse("permissions/"),parse:e.parse}}])}(e,r),function(e,r,n){"use strict";r.service("baasicPermissionsService",["$q","$filter","baasicApiHttp","baasicApiService","baasicConstants","baasicPermissionsRouteService","baasicAuthorizationService",function(r,t,s,i,a,c,o){function u(e){return e===n||null===e||""===e}function f(e){return s.get(c.getRoles.expand(i.findParams(e)))}function p(e){return s.get(c.getUsers.expand(i.findParams(e)))}function h(e){return e.replace(/^./,function(e){return e.toLowerCase()})}var m=t("orderBy"),d=t("filter");return{routeService:c,find:function(r,n){var t=e.extend({},n);return t.section=r,s.get(c.find().expand(i.findParams(t)))},getActions:function(e){return s.get(c.getActions.expand(i.findParams(e)))},getPermissionSubjects:function(n){var t=[],s=p(n).success(function(r){e.forEach(r.item,function(r){var n={name:r.userName,role:""};e.extend(n,r),t.push(n)})}),i=f(n).success(function(r){e.forEach(r.item,function(r){var n={name:r.name,roleName:r.name,userName:""};e.extend(n,r),t.push(n)})});return r.all([s,i]).then(function(){return m(t,"name")})},create:function(e){return s.post(c.create.expand(),i.createParams(e)[a.modelPropertyName])},remove:function(e){var r=i.removeParams(e),n=e.actions[0],t=u(e.role)?"User":"Role";return s.delete(r[a.modelPropertyName].links("delete"+n.abrv+t).href)},preparePermissions:function(r,t,s,i){var a=this,c=e.copy(d(i,function(e){return u(r.pagingInfo.search)?!0:e.name.indexOf(r.pagingInfo.search)>-1}));return e.forEach(s,function(r){e.forEach(t,function(n){var t=d(r.actions,function(e){return e.abrv===n.abrv});if(0===t.length){var s={checked:!1};e.extend(s,n),r.actions.push(s)}else e.forEach(t,function(e){e.checked=!0})}),r.actions=m(r.actions,"name");var s=a.findPermission(r,c);s===n?c.push(r):e.extend(s,r)}),c},createPermission:function(r,n,t){var s={dirty:!0,role:t.roleName,userName:t.userName,section:r,actions:[]};return e.forEach(n,function(r){var n={checked:!1};e.extend(n,r),s.actions.push(n)}),s},findPermission:function(e,r){for(var t=0;t<r.length;t++){var s=r[t];if(s.section===e.section&&(!u(s.role)&&!u(e.role)&&s.role===e.role||!u(s.userName)&&!u(e.userName)&&s.userName===e.userName))return s}return n},exists:function(e,r){return!(this.findPermission(e,r)===n)},togglePermission:function(r,n){var t={};e.extend(t,r),t.actions=[n];var s;return(s=n.checked?this.create:this.remove)(t)},getModulePermissions:function(e){var r={update:o.hasPermission(h(e)+".update"),create:o.hasPermission(h(e)+".create"),remove:o.hasPermission(h(e)+".delete"),read:o.hasPermission(h(e)+".read")};return r}}}])}(e,r),function(e,r){"use strict";r.service("baasicRecaptchaService",["recaptchaKey",function(e){return{create:function(r,n){var t=r.attr("id");t||(t="recaptcha-"+1e4*Math.random(),r.attr("id",t)),Recaptcha.create(e,t,n)},challenge:function(){return Recaptcha.get_challenge()},response:function(){return Recaptcha.get_response()},reload:function(){Recaptcha.reload()},destroy:function(){Recaptcha.destroy()}}}])}(e,r)}(angular);